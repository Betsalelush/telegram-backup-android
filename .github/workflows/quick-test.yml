name: Quick Test

on:
  # ×”×¤×¢×œ×” ×™×“× ×™×ª
  workflow_dispatch:
  
  # ×”×¤×¢×œ×” ××•×˜×•××˜×™×ª ×‘-pull requests
  pull_request:
    branches:
      - master
    paths:
      - 'app/**/*.py'
      - 'main*.py'
      - 'requirements*.txt'
      - 'buildozer.spec'
      - 'pytest.ini'

jobs:
  test:
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'
    
    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements_full.txt
        pip install -r requirements-test.txt
    
    - name: ğŸ” Check Python syntax
      run: |
        echo "ğŸ” ×‘×•×“×§ syntax ×©×œ ×§×‘×¦×™ Python..."
        python -m py_compile app/__init__.py
        python -m py_compile app/config.py
        python -m py_compile app/main.py
        python -m py_compile app/managers/*.py
        python -m py_compile app/screens/*.py
        python -m py_compile app/utils/*.py
        python -m py_compile main.py
        python -m py_compile main_*.py
        echo "âœ… ×›×œ ×”×§×‘×¦×™× ×ª×§×™× ×™×!"
    
    - name: ğŸ§ª Run tests
      run: |
        echo "ğŸ§ª ××¨×™×¥ ×‘×“×™×§×•×ª..."
        pytest tests/ -v --tb=short
        echo "âœ… ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×•!"
    
    - name: ğŸ“¦ Validate requirements files
      run: |
        echo "ğŸ“¦ ×‘×•×“×§ ×§×‘×¦×™ requirements..."
        for req in requirements*.txt; do
          echo "  - ×‘×•×“×§ $req"
          pip install --dry-run -r "$req" > /dev/null 2>&1 || echo "âš ï¸ Warning: $req may have issues"
        done
        echo "âœ… ×‘×“×™×§×ª requirements ×”×•×©×œ××”!"
    
    - name: ğŸ”§ Validate buildozer.spec
      run: |
        echo "ğŸ”§ ×‘×•×“×§ buildozer.spec..."
        
        # ×‘×“×™×§×” ×©×”×§×•×‘×¥ ×§×™×™×
        if [ ! -f "buildozer.spec" ]; then
          echo "âŒ buildozer.spec ×œ× × ××¦×!"
          exit 1
        fi
        
        # ×‘×“×™×§×” ×©×©×“×•×ª ×—×•×‘×” ×§×™×™××™×
        required_fields=("title" "package.name" "package.domain" "requirements")
        for field in "${required_fields[@]}"; do
          if ! grep -q "^$field" buildozer.spec; then
            echo "âŒ ×©×“×” ×—×•×‘×” ×—×¡×¨: $field"
            exit 1
          fi
        done
        
        echo "âœ… buildozer.spec ×ª×§×™×Ÿ!"
    
    - name: ğŸ‰ All checks passed
      run: |
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "âœ… ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”!"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        echo "ğŸ“ ××” × ×‘×“×§:"
        echo "  âœ… Python syntax"
        echo "  âœ… Unit tests"
        echo "  âœ… Requirements files"
        echo "  âœ… buildozer.spec structure"
        echo ""
        echo "ğŸš€ ×”×§×•×“ ××•×›×Ÿ ×œ×‘× ×™×™×”!"
        echo ""
        echo "ğŸ’¡ ×›×“×™ ×œ×‘× ×•×ª APK ××œ×:"
        echo "   Actions â†’ Build Android APK â†’ Run workflow"
