# זיכרון פרויקט - Telegram Backup Android

מסמך זה מרכז את כל המידע הטכני, ההחלטות העיצוביות, התיקונים הקריטיים והסטטוס הנוכחי של הפרויקט. מטרתו לשמש כנקודת ייחוס להמשך הפיתוח ולמנוע חזרה על טעויות עבר.

---

## 1. סקירה כללית
**שם האפליקציה:** Telegram Backup
**מטרה:** כלי אנדרואיד לניהול חשבונות טלגרם, העברת הודעות בין ערוצים, והורדת גיבויים למכשיר.
**גרסה נוכחית:** 3.1

## 2. טכנולוגיות ותשתיות
*   **שפה:** Python 3
*   **UI Framework:** Kivy + KivyMD 2.0.0 (Master Branch - גרסת פיתוח עדכנית).
*   **ספריית טלגרם:** Telethon 1.36.0.
*   **Build System:** Buildozer (Android).
*   **אחסון:** קבצי Session מקומיים, קבצי JSON לקונפיגורציה.

## 3. ארכיטקטורה
האפליקציה בנויה במבנה של **Managers** (לוגיקה) ו-**Screens** (תצוגה):

### Managers (לוגיקה)
*   `AccountManager`: ניהול התחברות (SMS/QR), שמירת Session, טעינת חשבונות.
*   `TransferManager`: ניהול העתקה/העברה של הודעות בין ערוצים.
*   `DownloadManager`: ניהול הורדות מדיה למכשיר, כולל דחיסה ל-ZIP.
*   `ProgressManager`: (אופציונלי) מעקב התקדמות.

### Screens (תצוגה)
*   `ActionScreen`: המסך הראשי. כפתורים בצורת "נקניקייה" (Stadium), בורר ערכת נושא (יום/לילה).
*   `AccountsScreen`: רשימת חשבונות, הוספת חשבון (פלוס), תפריט פעולות לכל חשבון.
*   `TransferScreen`: דאשבורד להעברות. בחירת מקור/יעד, סוגי קבצים, מצב העברה.
*   `DownloadScreen`: דאשבורד להורדות. בחירת ערוץ, סוגי קבצים.
*   `LogScreen`: הצגת לוגים חיים (Matrix Style).

---

## 4. לקחים ותיקונים קריטיים (חשוב לזכור!)

### KivyMD 2.0.0 (Master)
אנחנו עובדים עם גרסה חדשה מאוד, מה שדרש שינויים רבים מהתחביר הישן:
*   **כפתורים:** השימוש הוא ב-`MDButton`.
    *   **עיצוב:** `style="filled"`.
    *   **צורה:** כדי לקבל צורת "נקניקייה" (Stadium), יש להגדיר `radius` כרשימה של 4 ערכים שהם חצי מהגובה (למשל: גובה 54dp -> רדיוס 27).
*   **סרגל עליון:** `MDTopAppBar` החדש דורש `LeadingButtonContainer`, `MDTopAppBarTitle`, ו-`TrailingButtonContainer`.
*   **שדות טקסט:** `MDTextField` עם `MDTextFieldTrailingIcon` לאייקונים (כמו הדבקה).

### תיקוני באגים משמעותיים
1.  **קריסת Sentry בייבוא:** תוקן על ידי הוספת `exceptiongroup`, `asyncgui`, `asynckivy` ל-`buildozer.spec`.
2.  **ייבוא שגוי ב-Telethon:** `MessageMediaVideo` לא קיים ישירות. יש להשתמש ב-`MessageMediaDocument` ולבדוק מאפיינים (כמו duration) כדי לזהות וידאו.
3.  **לוגים (TextInput):** לרכיב `TextInput` של **Kivy** (לא MD) אין מאפיין `text_color`. יש להשתמש ב-`foreground_color`. שימוש ב-`text_color` גורם לקריסה מיידית.
4.  **כפתור הדבקה (Paste):** כריכה (Binding) בתוך לולאה או פונקציה חייבת להיות מפורשת: `lambda x, f=field: self.do_paste(f)`. בלי זה, ההדבקה לא עובדת.
5.  **הוספת רכיבים כפולה:** שגיאת `Widget already has a parent` נגרמת כשמנסים להוסיף את אותו כפתור פעמיים ל-Layout. יש לוודא שהקוד נקי מכפילויות `add_widget`.
6.  **ערכת נושא (Theme):** כשמחליפים בין Light/Dark, הרקע של המסכים (`Screen`) לא מתעדכן אוטומטית. הוספנו לוגיקה בכל מסך (`on_enter` או ב-init) שקובעת את `md_bg_color` לפי `app.theme_cls.backgroundColor`.

### קונפיגורציית אנדרואיד (Buildozer)
*   **הרשאות:** `INTERNET`, `WRITE_EXTERNAL_STORAGE`, `READ_EXTERNAL_STORAGE`.
*   **Requirements:** חיוני לכלול את כל הספריות האסינכרוניות (`asyncgui`, `asynckivy`) כדי שהאפליקציה לא תקרוס בטעינה.

---

## 5. מצב נוכחי (לגרסה 3.1)
*   **עיצוב:** כפתורים עגולים (Stadium), עיצוב נקי יותר.
*   **צבעים:** תמיכה מלאה במצב כהה (שחור/לבנדר) ומצב בהיר (לבן/אפור).
*   **פונקציונליות:**
    *   התחברות עובדת (SMS/QR/Global API).
    *   העברה עובדת.
    *   הורדה (כולל ZIP) עובדת.
    *   לוגים עובדים.

## 6. משימות פתוחות/לעתיד
*   לוודא שה-APK בגרסה 3.1 עובד חלק במכשיר הפיזי.
*   בדיקת הורדות של קבצים גדולים (זיכרון).
*   מעקב אחרי שינויים עתידיים ב-KivyMD במידה וישברו תאימות שוב.
